<html>
    <canvas id="myCanvas"></canvas>
<script>
var cnvs = document.getElementById("myCanvas");
cnvs.width = window.innerWidth;
cnvs.height = window.innerHeight;
var ctx = cnvs.getContext("2d");

window.screen.orientation.lock("portrait"); 

// vars
var rX = 0; // rotation in rads
var rY = 0;
var rZ = 0;

var x;  // position
var y;
var z;

var stepPrintY = 40;
var printY = stepPrintY;
function printData(context, label, data) {
    ctx.font = "40px Arial";
    context.fillText(label + data, 20, printY);
    printY += stepPrintY;
}

// round the data from the IMU
function roundData(data) {
    var tmp = {};

    for (const p in data) {
        tmp[p] = Math.round(data[p] * 100) / 100;
    }

    return tmp;
}

function degreesToRads(data) {
    var tmp = {};

    for (const p in data) {
        tmp[p] = data[p] * Math.PI / 180;
    }

    return tmp;
}

// trackRotation takes the gyro data in radians and interval (delta time in milliseconds)
function trackRotation(g, dt) {
    rX += g.beta * dt/1000;
    rY += g.gamma * dt/1000;
    rZ += g.alpha * dt/1000;
}

function accelerometerUpdate(e) {
    ctx.clearRect(0, 0, cnvs.width, cnvs.height);
    printY = stepPrintY;

    // Note: these seem to only have 2 digits of precision
    // clone objects because event data read only 
    var accel = e.accelerationIncludingGravity;
    var gyro = e.rotationRate;
    var deltaTime = e.interval; 

    accel = roundData(accel);
    gyro = roundData(gyro);
    gyro = degreesToRads(gyro);

    trackRotation(gyro, deltaTime);

    //The following two lines are to calculate tilt from grav vector.
    // var xPosition = Math.atan2(aY, aZ);
    // var yPosition = Math.atan2(aX, aZ);
    // ctx.fillText("tilt x: " + xPosition, 20, 200);
    // ctx.fillText("tilt y: " + yPosition, 20, 240);

    printData(ctx, "aX: ", accel.x);
    printData(ctx, "aY: ", accel.y);
    printData(ctx, "aZ: ", accel.z);

    // printData(ctx, "gX: ", gyro.beta);
    // printData(ctx, "gY: ", gyro.gamma);
    // printData(ctx, "gZ: ", gyro.alpha);

    printData(ctx, "dt: ", deltaTime);

    printData(ctx, "rX: ", rX);
    printData(ctx, "rY: ", rY);
    printData(ctx, "rZ: ", rZ);
}


//================ Event listeners ===============================

if (window.DeviceMotionEvent == undefined) {
    //No accelerometer is present. Use buttons. 
    alert("no accelerometer");
}
else {
    alert("accelerometer found");
    window.addEventListener("devicemotion", accelerometerUpdate, true);
}

</script>
</html>